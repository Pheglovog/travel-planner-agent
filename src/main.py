"""
Travel Planner Agent - ä¸»ç¨‹åºå…¥å£
æ”¯æŒç”¨æˆ·è¾“å…¥ç›®çš„åœ°ã€å¤©æ•°ã€é¢„ç®—ã€åå¥½ï¼Œç”Ÿæˆæ—…è¡Œè§„åˆ’ã€é¢„ç®—è®¡ç®—å’Œæ‰“åŒ…æ¸…å•
"""

import asyncio
import os
from typing import List, Dict, Any
from langchain.llms import OpenAI
from langchain.chains import ConversationChain
from langchain.memory import ConversationBufferMemory
from langchain.prompts import PromptTemplate, FewShotPromptTemplate
from langchain.agents import AgentExecutor, create_tool_calling_agent
from dotenv import load_dotenv

# å¯¼å…¥è‡ªå®šä¹‰å·¥å…·
from src.agents.planner import planner_agent
from src.agents.checklist import checklist_agent
from src.agents.budget import budget_agent
from src.tools import weather, currency, maps

# åŠ è½½ç¯å¢ƒå˜é‡
load_dotenv()

# åˆå§‹åŒ– LangChain
llm = OpenAI(
    model=os.getenv("LLM_MODEL", "gpt-4o-mini"),  # ä½¿ç”¨æˆæœ¬è¾ƒä½çš„æ¨¡å‹
    temperature=0.7
)

# åˆ›å»ºè®°å¿†
memory = ConversationBufferMemory(
    llm=llm,
    memory_key="chat_history",
    return_messages=True
)

# åˆ›å»ºä¸» Agent
agent_executor = AgentExecutor(
    llm=llm,
    memory=memory,
    verbose=True,
    handle_parsing_errors=True
)

def print_banner():
    """æ‰“å°æ¬¢è¿æ¨ªå¹…"""
    banner = r"""
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘                                                      â•‘
    â•‘     ğŸŒ¸  Travel Planner Agent ğŸŒ¸                    â•‘
    â•‘                                                      â•‘
    â•‘     æ™ºèƒ½æ—…è¡Œè§„åˆ’åŠ©æ‰‹ ğŸ§³ï¸                          â•‘
    â•‘                                                      â•‘
    â•‘     åŠŸèƒ½ï¼šè¡Œç¨‹è§„åˆ’ Â· é¢„ç®— Â· æ¸…å•ç”Ÿæˆ             â•‘
    â•‘                                                      â•‘
    â•‘     åŸºäº LangChain æ‰“é€ æ™ºèƒ½æ—…è¡Œä½“éªŒ                        â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    """
    print(banner)


def get_user_input() -> Dict[str, Any]:
    """è·å–ç”¨æˆ·è¾“å…¥"""
    print("\n" + "="*50)
    print("ğŸŒ¸ æ¬¢è¿ä½¿ç”¨ Travel Planner Agent")
    print("="*50)
    print()
    
    print("ğŸ“‹ è¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼ˆæˆ–æŒ‰æç¤ºè¾“å…¥ï¼‰:\n")
    
    destination = input("ğŸŒ¸ ç›®çš„åœ°ï¼ˆå¦‚ï¼šä¸œäº¬ã€äº¬éƒ½ã€å¤§é˜ªï¼‰ï¼š").strip() or "ä¸œäº¬"
    days = input("â° æ—…è¡Œå¤©æ•°ï¼š").strip() or "7"
    budget = input("ğŸ’° é¢„ç®—ï¼ˆäººæ°‘å¸ï¼‰ï¼š").strip() or "200000"
    preference = input("ğŸ¯ æ—…è¡Œåå¥½ï¼ˆ1.å†å²å¤è¿¹  2.è‡ªç„¶æ™¯è§‚  3.è´­ç‰©ï¼‰ï¼š").strip() or "3"
    
    return {
        "destination": destination,
        "days": days,
        "budget": budget,
        "preference": preference
    }


async def plan_travel(user_input: Dict[str, Any]) -> Dict[str, Any]:
    """ä½¿ç”¨ AI Agent è§„åˆ’è¡Œç¨‹"""
    print("\n" + "="*50)
    print("ğŸ¤– AI Agent æ­£åœ¨è§„åˆ’ä½ çš„æ—…è¡Œ...")
    print("="*50)
    print()
    
    # åˆ›å»ºæç¤ºè¯æ¨¡æ¿
    planning_template = PromptTemplate.from_template("""
    ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„æ—…è¡Œè§„åˆ’å¸ˆã€‚è¯·æ ¹æ®ä»¥ä¸‹ä¿¡æ¯è§„åˆ’ä¸€ä»½è¯¦ç»†çš„æ—…è¡Œè¡Œç¨‹ï¼š

    ç›®çš„åœ°ï¼š{destination}
    æ—…è¡Œå¤©æ•°ï¼š{days} å¤©
    æ€»é¢„ç®—ï¼š{budget} äººæ°‘å¸
    æ—…è¡Œåå¥½ï¼š{preference}

    è¯·æŒ‰ç…§ä»¥ä¸‹è¦æ±‚è§„åˆ’ï¼š
    1. æ¯å¤©çš„è¡Œç¨‹è¦ä¸°å¯Œä½†ä¸è¦è¿‡äºç´§å¼ 
    2. æ ¹æ®åå¥½åˆç†å®‰æ’æ´»åŠ¨ç±»å‹ï¼ˆå¤è¿¹ã€è‡ªç„¶æ™¯è§‚ã€è´­ç‰©ï¼‰
    3. æ¯å¤©å»ºè®® 1-2 ä¸ªä¸»è¦æ™¯ç‚¹ï¼Œé¢„ç•™è‡ªç”±æ´»åŠ¨æ—¶é—´
    4. æ¨èäº¤é€šä¾¿åˆ©çš„äº¤é€šæ–¹å¼ï¼ˆæ–°å¹²çº¿æ˜¯é¦–é€‰ï¼‰
    5. æ¨èæ€§ä»·æ¯”é«˜çš„ä½å®¿
    6. ç•™å‡ºé€‚é‡çš„è´­ç‰©å’Œçºªå¿µå“é¢„ç®—
    7. è®¡ç®—å¹¶æ˜¾ç¤ºå„å¤©çš„ä¸»è¦è´¹ç”¨
    8. æä¾›å®ç”¨çš„æ—…è¡Œå°è´´å£«

    è¾“å‡ºæ ¼å¼è¦æ±‚ï¼š
    - ä½¿ç”¨ emoji å¢å¼ºå¯è¯»æ€§
    - ä½¿ç”¨ clear åˆ†éš”ä¸åŒçš„éƒ¨åˆ†
    - æ¯ä¸ªæ™¯ç‚¹ç»™å‡ºç®€çŸ­ä»‹ç»
    - åŒ…å«é¢„ç®—åˆ†æå’ŒèŠ‚çº¦å»ºè®®

    è¯·ä»¥ JSON æ ¼å¼è¾“å‡ºå®Œæ•´çš„è¡Œç¨‹è§„åˆ’ã€‚
    """)
    
    # åˆ›å»ºè§„åˆ’é“¾
    planning_chain = planning_template | llm
    
    try:
        result = planning_chain.invoke({
            "destination": user_input["destination"],
            "days": user_input["days"],
            "budget": user_input["budget"],
            "preference": user_input["preference"]
        })
        
        print("\n" + "="*50)
        print("ğŸ¯ è¡Œç¨‹è§„åˆ’å®Œæˆï¼")
        print("="*50)
        print()
        
        return result
        
    except Exception as e:
        print(f"\nâŒ è§„åˆ’å¤±è´¥: {e}")
        print("="*50)
        print()
        return {
            "error": str(e),
            "message": "æŠ±æ­‰ï¼Œè§„åˆ’è¿‡ç¨‹ä¸­å‡ºç°äº†é—®é¢˜ã€‚è¯·é‡è¯•ã€‚"
        }


async def generate_checklist(user_input: Dict[str, Any], itinerary: str) -> Dict[str, Any]:
    """æ ¹æ®è¡Œç¨‹ç”Ÿæˆæ‰“åŒ…æ¸…å•"""
    print("\n" + "="*50)
    print("ğŸ’ ç”Ÿæˆæ‰“åŒ…æ¸…å•...")
    print("="*50)
    print()
    
    # ä»è¡Œç¨‹ä¸­æå–æ´»åŠ¨ä¿¡æ¯ï¼ˆç®€åŒ–ç‰ˆï¼‰
    # å®é™…ä¸­åº”è¯¥ä½¿ç”¨ç»“æ„åŒ–æ•°æ®è§£æ
    
    # åˆ›å»ºæ‰“åŒ…æ¸…å•æ¨¡æ¿
    checklist_template = PromptTemplate.from_template("""
    ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„æ—…è¡Œé¡¾é—®ã€‚è¯·æ ¹æ®ä»¥ä¸‹è¡Œç¨‹è§„åˆ’ç”Ÿæˆä¸€ä»½è¯¦ç»†çš„æ‰“åŒ…æ¸…å•ï¼š

    ç›®çš„åœ°ï¼š{destination}
    æ—…è¡Œå¤©æ•°ï¼š{days}
    æ€»é¢„ç®—ï¼š{budget} äººæ°‘å¸
    æ—…è¡Œåå¥½ï¼š{preference}

    æ—…è¡Œè¡Œç¨‹æ¦‚è§ˆï¼š
    {itinerary}

    è¯·æ ¹æ®è¡Œç¨‹å’Œåå¥½ç”Ÿæˆæ‰“åŒ…æ¸…å•ï¼Œè¦æ±‚å¦‚ä¸‹ï¼š

    1. ğŸ“š åŸºæœ¬å¿…éœ€å“
       - èº«ä»½è¯ä»¶ã€æŠ¤ç…§ã€ç­¾è¯ã€æœºç¥¨ã€é…’åº—é¢„è®¢ç¡®è®¤å•
       - ç°é‡‘å’Œé“¶è¡Œå¡
       - æ‰‹æœºå’Œå……ç”µå™¨ï¼ˆé€‚é…æ—¥æœ¬ç”µå‹ 100Vï¼‰
       - ç›¸æœºå’Œå¤‡ç”¨ç”µæ± 
       - è½¬æ¢æ’å¤´å’Œå……ç”µçº¿

    2. ğŸ‘• è¡£ç‰©ï¼ˆ7å¤©ï¼‰
       - å†…è¡£ï¼ˆ7å¥—ï¼‰
       - å¤–å¥—ï¼ˆæ ¹æ®å¤©æ°”ï¼‰
       - å†…è¡£ï¼ˆ7å¥—ï¼‰
       - è¢œå­ï¼ˆ2æ¡ï¼‰
       - è¢œå­ï¼ˆ3æ¡ï¼‰
       - è¢œå­ï¼ˆ3æ¡ï¼‰
       - ç¡å­ï¼ˆ5åŒï¼‰
       - é¢†å¸¦ï¼ˆ3æ¡ï¼‰
       - ç¡å­ï¼ˆ3åŒï¼‰
       - å›´å·¾ï¼ˆ2æ¡ï¼‰
       - æ¯›å¸½ï¼ˆ1é¡¶ï¼‰
       - å¤ªé˜³é•œï¼ˆ1é¡¶ï¼‰
       - é›¨ä¼ï¼ˆ1é¡¶ï¼‰
       - ä¸€æ¬¡æ€§å†…è¡£ï¼ˆ3æ¡ï¼‰

    3. ğŸ§´ æ´—æŠ¤ç”¨å“
       - ç‰™è†å¥—è£…ï¼ˆ2å¥—ï¼‰
       - æ¯›å·¾ï¼ˆ3æ¡ï¼‰
       - æ´—å‘æ°´ï¼ˆå°ç“¶è£…ï¼‰
       - æ´—å‘æ¶²ï¼ˆå°ç“¶è£…ï¼‰
       - é¦™çš‚ï¼ˆ1æ¡ï¼‰
       - æ¯›å·¾ï¼ˆ1æ¡ï¼‰
       - å‰ƒé¡»åˆ€ï¼ˆ1æŠŠï¼‰
       - æŒ‡ç”²åˆ€ï¼ˆ1æŠŠï¼‰
       - æ‹–é‹ï¼ˆ1åŒï¼‰
       - ç¡å­ï¼ˆ3åŒï¼‰
       - å‰ƒé¡»åˆ€ï¼ˆ3åŒï¼‰

    4. ğŸ“± ç”µå­è®¾å¤‡
       - ç§»åŠ¨ç”µæºï¼ˆ20000mAh å……ç”µå®ï¼‰
       - ç›¸æœºï¼ˆæ¨èå¾®å•æˆ–å¡ç‰‡æœºï¼‰
       - æ‰‹æœºæ”¯æ¶ï¼ˆç”¨äºæ‹æ‘„ï¼‰

    5. ğŸ§» åŒ»ç–—ç”¨å“
       - å¸¸ç”¨æ„Ÿå†’è¯
       - èƒƒè¯è´´ï¼ˆåˆ›å¯è´´ï¼‰
       - æ™•è½¦è¯ï¼ˆæ—¥æœ¬å“ç‰Œï¼‰
       - é˜²æ™’éœœï¼ˆSPF50+ï¼‰
       - èšŠè™«è¯ï¼ˆé¿èšŠè™«ï¼‰
       - ä½“æ¸©è®¡
       - æ™•è½¦è¯ï¼ˆé¢„é˜²æ™•è½¦ï¼‰

    6. ğŸ“¦ å…¶ä»–å¿…éœ€å“
       - æ°´å£¶ï¼ˆæ—¥æœ¬è‡ªæ¥æ°´ä¸é€‚åˆé¥®ç”¨ï¼‰
       - ä¿æ¸©æ¯
       - å°é›¶é£Ÿ
       - çœ¼é•œ
       - è¡Œæç®±
       - é”å…·ç®±

    é‡è¦ç‰©å“æé†’ï¼š
    ğŸ’¡ ä¸è¦å¿˜è®°å¸¦æŠ¤ç…§å’Œç­¾è¯åŸä»¶ï¼
    ğŸ’¡ ç¡®ä¿å……ç”µå™¨æ”¯æŒæ—¥æœ¬ç”µå‹ï¼ˆ100Vï¼‰
    ğŸ’¡ ç›¸æœºå†…å­˜å’Œå­˜å‚¨å¡æå‰å‡†å¤‡å……è¶³

    è¾“å‡ºæ ¼å¼è¦æ±‚ï¼š
    - ä½¿ç”¨ emoji åˆ†ç±»å¢å¼ºå¯è¯»æ€§
    - å¯¹é‡è¦ç‰©å“ï¼ˆå¦‚æŠ¤ç…§ã€ç­¾è¯ï¼‰ä½¿ç”¨ âš ï¸ æ ‡è®°
    - å¯¹æ¯ç±»ç‰©å“æä¾›ç®€è¦è¯´æ˜
    - æ•°é‡æ ‡æ³¨è¦åˆç†ï¼ˆå¦‚ï¼š7å¥—å†…è¡£ = 14+14+3+3ï¼‰

    è¯·ä»¥ JSON æ ¼å¼è¾“å‡ºå®Œæ•´çš„æ‰“åŒ…æ¸…å•ã€‚
    """)
    
    # åˆ›å»ºæ¸…å•ç”Ÿæˆé“¾
    checklist_chain = checklist_template | llm
    
    try:
        result = checklist_chain.invoke({
            "itinerary": str(itinerary),
            "destination": user_input["destination"],
            "days": user_input["days"],
            "budget": user_input["budget"],
            "preference": user_input["preference"]
        })
        
        print("\n" + "="*50)
        print("ğŸ’ æ‰“åŒ…æ¸…å•ç”Ÿæˆå®Œæˆï¼")
        print("="*50)
        print()
        
        return result
        
    except Exception as e:
        print(f"\nâŒ æ¸…å•ç”Ÿæˆå¤±è´¥: {e}")
        print("="*50)
        print()
        return {
            "error": str(e),
            "message": "æŠ±æ­‰ï¼Œç”Ÿæˆæ¸…å•è¿‡ç¨‹ä¸­å‡ºç°äº†é—®é¢˜ã€‚è¯·é‡è¯•ã€‚"
        }


async def calculate_budget(user_input: Dict[str, Any]) -> Dict[str, Any]:
    """è®¡ç®—æ—…è¡Œé¢„ç®—"""
    print("\n" + "="*50)
    print("ğŸ’° é¢„ç®—è®¡ç®—ä¸­...")
    print("="*50)
    print()
    
    # åˆ›å»ºé¢„ç®—è®¡ç®—æç¤ºè¯æ¨¡æ¿
    budget_template = PromptTemplate.from_template("""
    ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„æ—…è¡Œè´¢åŠ¡é¡¾é—®ã€‚è¯·æ ¹æ®ä»¥ä¸‹ä¿¡æ¯è®¡ç®—è¯¦ç»†çš„æ—…è¡Œé¢„ç®—ï¼š

    ç›®çš„åœ°ï¼š{destination}
    æ—…è¡Œå¤©æ•°ï¼š{days} å¤©
    æ€»é¢„ç®—ï¼š{budget} äººæ°‘å¸
    æ—…è¡Œåå¥½ï¼š{preference}

    å½“å‰æ±‡ç‡ï¼ˆå‚è€ƒï¼‰ï¼š1 äººæ°‘å¸ = 0.21 æ—¥å…ƒ

    è¯·æŒ‰ç…§ä»¥ä¸‹è¦æ±‚è®¡ç®—é¢„ç®—ï¼š

    1. ğŸ’± äº¤é€šè´¹ç”¨
       - å¾€è¿”æœºç¥¨ï¼šçº¦å æ€»é¢„ç®—çš„ 25-35%
       - æ—¥æœ¬å›½å†…äº¤é€šï¼šçº¦å æ€»é¢„ç®—çš„ 15-20%
         - æ¨èä½¿ç”¨ JR Passï¼ˆ7å¤©é€šç¥¨ï¼‰

    2. ğŸ¨ ä½å®¿è´¹ç”¨
       - é…’åº—ï¼šçº¦å æ€»é¢„ç®—çš„ 25-35%
       - æ¨èé¢„è®¢å•†åŠ¡é…’åº—æˆ–ç»æµå‹é…’åº—
       - å¹³å‡è´¹ç”¨ï¼š1500-3000 äººæ°‘å¸/æ™š

    3. ğŸœ é¤é¥®è´¹ç”¨
       - çº¦å æ€»é¢„ç®—çš„ 20-25%
       - å»ºè®®ï¼šä¾¿åˆ©åº—æ—©é¤ + æ‹‰é¢æ™šé¤
       - å¹³å‡è´¹ç”¨ï¼š2000-3000 äººæ°‘å¸/å¤©

    4. ğŸ« é—¨ç¥¨å’Œå¨±ä¹
       - çº¦å æ€»é¢„ç®—çš„ 10-15%
       - é—¨ç¥¨ï¼šå¯ºåº™ã€ç¥ç¤¾ã€ç¯çƒå½±åŸã€è¿ªå£«å°¼ï¼ˆæ ¹æ®é€‰æ‹©ï¼‰
       - å¹³å‡è´¹ç”¨ï¼š1000-2000 äººæ°‘å¸/å¤©

    5. ğŸ› è´­ç‰©
       - çº¦å æ€»é¢„ç®—çš„ 5-10%
       - å»ºè®®ï¼šè¯å¦†åº—ã€ç”µå™¨åº—ã€ç™¾å…ƒåº—ã€1000 ç‰åº—

    6. ğŸ’³ å…¶ä»–è´¹ç”¨
       - ç”µè¯å¡ï¼šçº¦ 500 äººæ°‘å¸/æœˆ
       - æ—…æ¸¸ä¿é™©ï¼šçº¦ 300-1000 äººæ°‘å¸/æ¬¡
       - åº”æ€¥å¤‡ç”¨é‡‘ï¼šå»ºè®®é¢„ç•™ 10,000 äººæ°‘å¸

    7. ğŸ“Š è´¹ç”¨åˆ†æ
       - æ€»è®¡ï¼šæ±‡æ€»æ‰€æœ‰è´¹ç”¨
       - äººæ°‘å¸å¯¹æ—¥å…ƒè½¬æ¢ï¼šæ˜¾ç¤ºé‡‘é¢æ¢ç®—

    æ±‡ç‡è½¬æ¢å»ºè®®ï¼š
       ğŸ’¡ å½“å‰æ±‡ç‡ä»…ä¾›å‚è€ƒï¼Œå®é™…ä»¥é“¶è¡Œå…‘æ¢æ±‡ç‡ä¸ºå‡†
       ğŸ’¡ å»ºè®®ä½¿ç”¨ä¿¡ç”¨å¡æˆ–å½“åœ° ATM å–ç°
       ğŸ’¡ æ—¥æœ¬å¤§éƒ¨åˆ†åœ°æ–¹æ”¯æŒç°é‡‘ï¼Œä½†æœ€å¥½å‡†å¤‡ä¸€äº›é›¶é’±

    è¾“å‡ºæ ¼å¼è¦æ±‚ï¼š
    - ä½¿ç”¨è¡¨æ ¼å½¢å¼å±•ç¤ºè´¹ç”¨æ˜ç»†
    - åŒ…å«æ€»é¢„ç®—å¯¹æ¯”
    - æä¾›èŠ‚çº¦å»ºè®®
    - ä»¥ JSON æ ¼å¼è¾“å‡ºè¯¦ç»†åˆ†æ

    è¯·ä»¥ JSON æ ¼å¼è¾“å‡ºå®Œæ•´çš„é¢„ç®—åˆ†ææŠ¥å‘Šã€‚
    """)
    
    # åˆ›å»ºé¢„ç®—è®¡ç®—é“¾
    budget_chain = budget_template | llm
    
    try:
        result = budget_chain.invoke({
            "destination": user_input["destination"],
            "days": user_input["days"],
            "budget": user_input["budget"],
            "preference": user_input["preference"]
        })
        
        print("\n" + "="*50)
        print("ğŸ’° é¢„ç®—è®¡ç®—å®Œæˆï¼")
        print("="*50)
        print()
        
        return result
        
    except Exception as e:
        print(f"\nâŒ é¢„ç®—è®¡ç®—å¤±è´¥: {e}")
        print("="*50)
        print()
        return {
            "error": str(e),
            "message": "æŠ±æ­‰ï¼Œè®¡ç®—è¿‡ç¨‹ä¸­å‡ºç°äº†é—®é¢˜ã€‚è¯·é‡è¯•ã€‚"
        }


async def interactive_menu():
    """äº¤äº’å¼ä¸»èœå•"""
    while True:
        print("\n" + "="*50)
        print("ğŸŒ¸ Travel Planner Agent")
        print("="*50)
        print()
        
        print("è¯·é€‰æ‹©åŠŸèƒ½ï¼š\n")
        print("  1. ğŸ§³ï¸  è¡Œç¨‹è§„åˆ’")
        print("  2. ğŸ’ ç”Ÿæˆæ‰“åŒ…æ¸…å•")
        print("  3. ğŸ’° é¢„ç®—è®¡ç®—")
        print("  4. âŒ é€€å‡º")
        print()
        
        choice = input("è¯·è¾“å…¥é€‰é¡¹ï¼ˆ1-4ï¼‰ï¼š").strip()
        
        if choice == "1":
            user_input = get_user_input()
            await plan_travel(user_input)
            
        elif choice == "2":
            # ç®€åŒ–ç‰ˆï¼šç›´æ¥è°ƒç”¨ checklist ç”Ÿæˆ
            destination = input("ğŸŒ¸ ç›®çš„åœ°ï¼š").strip() or "ä¸œäº¬"
            days = input("â° æ—…è¡Œå¤©æ•°ï¼š").strip() or "7"
            budget = input("ğŸ’° é¢„ç®—ï¼ˆäººæ°‘å¸ï¼‰ï¼š").strip() or "200000"
            
            # ç”Ÿæˆç®€å•çš„è¡Œç¨‹ï¼ˆå®é™…åº”è¯¥ä»è§„åˆ’ç»“æœè·å–ï¼‰
            # è¿™é‡Œæš‚æ—¶ä½¿ç”¨ç¡¬ç¼–ç çš„è¡Œç¨‹æ¨¡æ¿
            itinerary = """
                ä¸œäº¬æ—…è¡Œè¡Œç¨‹æ¦‚è§ˆï¼š

                ç¬¬1å¤©ï¼šæŠµè¾¾ä¸œäº¬
                - æ´»åŠ¨ï¼šå…¥ä½é…’åº—ã€æµ…è‰å¯ºæ¢ç´¢ã€é“¶åº§è´­ç‰©
                - é¤é¥®ï¼šç­‘åœ°å¸‚åœºæ‹‰é¢
                - ä½å®¿ï¼šæ–°å®¿å•†åŠ¡é…’åº—

                ç¬¬2å¤©ï¼šäº¬éƒ½
                - æ´»åŠ¨ï¼šé‡‘é˜å¯ºã€ä¼è§ç¨»è·å¤§ç¤¾
                - é¤é¥®ï¼šæ€€çŸ³æ–™ç†
                - ä½å®¿ï¼šäº¬éƒ½å•†åŠ¡é…’åº—

                ç¬¬3-ï¼šå¤§é˜ª
                - æ´»åŠ¨ï¼šå¤§é˜ªåŸã€é“é¡¿æ˜åŠ¨ç‰©å›­
                - é¤é¥®ï¼šç« é±¼çƒ§
                - ä½å®¿ï¼šéš¾æ³¢å•†åŠ¡é…’åº—

                ç¬¬4å¤©ï¼šå¥ˆè‰¯
                - æ´»åŠ¨ï¼šä¸œå¤§å¯ºã€å¥ˆè‰¯ç”ºæ•£æ­¥
                - é¤é¥®ï¼šå‰é‡å®¶
                - ä½å®¿ï¼šå¥ˆè‰¯å•†åŠ¡é…’åº—

                ç¬¬5-6å¤©ï¼šå‘¨è¾¹æ¸¸
                - æ´»åŠ¨ï¼šæ ¹æ®å–œå¥½å®‰æ’
                - ä½å®¿ï¼šè¿”å›ä¸œäº¬

                ç¬¬7å¤©ï¼šè¿”ç¨‹
                - æ´»åŠ¨ï¼šè‡ªç”±è´­ç‰©
                """
            
            await generate_checklist({
                "destination": destination,
                "days": days,
                "budget": budget,
                "preference": "3",  # è‡ªç„¶æ™¯è§‚
                "itinerary": itinerary
            })
            
        elif choice == "3":
            user_input = get_user_input()
            await calculate_budget(user_input)
            
        elif choice == "4":
            print("\nğŸ‘‹ æ„Ÿè°¢ä½¿ç”¨ Travel Planner Agentï¼")
            print("ç¥æ‚¨æ—…é€”æ„‰å¿«ï¼âœˆï¸")
            print()
            break
        else:
            print("âŒ æ— æ•ˆé€‰é¡¹ï¼Œè¯·é‡æ–°é€‰æ‹©")


async def main():
    """ä¸»ç¨‹åºå…¥å£"""
    print_banner()
    
    # æ‰“å°ä½¿ç”¨è¯´æ˜
    print("\nä½¿ç”¨è¯´æ˜ï¼š")
    print("- è¾“å…¥ç›®çš„åœ°ã€å¤©æ•°ã€é¢„ç®—å’Œåå¥½å³å¯è‡ªåŠ¨è§„åˆ’")
    print("- æ”¯æŒå¤šç§æ—…è¡Œåå¥½")
    print("- é›†æˆå¤©æ°”ã€æ±‡ç‡æŸ¥è¯¢ç­‰å®ç”¨å·¥å…·")
    print("- åŸºäº LangChain æ™ºèƒ½ç”Ÿæˆå»ºè®®")
    print()
    
    await interactive_menu()


if __name__ == "__main__":
    import uvloop
    uvloop.run(main)
