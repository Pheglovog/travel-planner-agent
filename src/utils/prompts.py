"""
旅行规划 Agent
使用自然语言与 AI 交互，生成行程、打包清单和预算
"""

import os
from dotenv import load_dotenv

# 加载环境变量
load_dotenv()

# 配置
OPENAI_API_KEY = os.getenv("OPENAI_API_KEY", "")
DEFAULT_LLM_MODEL = os.getenv("LLM_MODEL", "gpt-4o-mini")


def create_planning_prompt(destination: str, days: int, budget: int, preference: str) -> str:
    """创建规划提示词"""
    
    preference_map = {
        "1": "历史古迹",
        "2": "自然景观",
        "3": "购物"
    }
    
    pref_desc = preference_map.get(preference, "综合体验")
    
    return f"""
    你是一位专业的日本旅行规划师。请根据以下信息规划一份详细的{days}天行程：

    ## 基本信息
    - 目的地：{destination}
    - 旅行天数：{days} 天
    - 总预算：{budget:,} 人民币
    - 旅行偏好：{pref_desc}

    ## 规划要求
    1. 每天的行程要丰富但不要过于紧张
    2. 根据偏好合理安排活动类型（古迹、自然景观、购物）
    3. 每天建议 1-2 个主要景点，预留自由活动时间
    4. 推荐交通便利的交通方式（新干线是首选）
    5. 推荐性价比高的住宿
    6. 留出适量的购物和纪念品预算
    7. 计算并显示各天的主要费用
    8. 提供实用的旅行小贴士

    ## 输出格式
    请按照以下 JSON 格式输出完整的行程规划：

    {{
        "daily_itinerary": {{
            "day_1": "第一天行程...",
            "day_2": "第二天行程...",
            ...
        }},
        "important_tips": ["贴士1", "贴士2"],
        "budget_breakdown": {{
            "transportation": "费用",
            "accommodation": "费用",
            "food": "费用",
            "tickets": "费用",
            "shopping": "费用",
            "others": "费用"
        }}
    }}
    """


def create_checklist_prompt(destination: str, days: int, preference: str, itinerary: str) -> str:
    """创建打包清单提示词"""
    
    pref_desc = {
        "1": "历史古迹",
        "2": "自然景观",
        "3": "购物"
    }.get(preference, "综合体验")
    
    return f"""
    你是一位专业的旅行顾问。请根据以下行程规划生成一份详细的{days}天旅行打包清单：

    ## 行程概览
    目的地：{destination}
    旅行天数：{days} 天
    总预算：{budget} 人民币
    旅行偏好：{pref_desc}

    {itinerary}

    请根据行程和偏好生成打包清单，要求如下：

    1. 📚 本品必需品
       - 身份证件（护照、签证、机票、酒店确认单）
       - 电子产品（手机、充电器、相机、移动电源）
       - 日常用品（牙刷、毛巾、洗发水、护肤品）

    2. 👕 衣物（7天）
       - 内衣（7套）
       - 外套（根据天气）
       - 袜子（2条）
       - 袜子（3条）
       - 袜子（3双）
       - 袜子（3双）
       - 袜子（5双）

    3. 🧴 洗护用品
       - 牙膏套装（2套）
       - 洗发水（小瓶装）
       - 洗发液（小瓶装）
       - 沐巾（2条）
       - 剃须刀（1把）
       - 拖鞋（1双）
       - 雨伞（1顶）
       - 一次性内衣（3条）

    4. 🧻 医疗用品
       - 感冒药（创可贴）
       - 感冒药贴（日本品牌）
       - 晕车药（预防晕车）
       - 体温计
       - 胃药（预防）
       - 晕车药（小瓶装）

    5. 📦 电子设备
       - 移动电源（20000mAh 充电宝）
       - 相机（推荐微单或卡片机）
       - 手机支架
       - 拖鞋包

    重要物品提醒：
    💡 不要忘记带护照和签证原件！
    💡 确保充电器支持日本电压（100V）
    💡 相机内存和存储卡提前准备充足

    输出格式要求：
    - 使用 emoji 分类增强可读性
    - 对重要物品（如护照、签证）使用 ⚠️ 标记
    - 对每类物品提供简要说明
    - 数量标注要合理（如：7套内衣 = 14+14+3+3）

    请以 JSON 格式输出完整的打包清单。
    """


def create_budget_prompt(destination: str, days: int, budget: int, preference: str) -> str:
    """创建预算计算提示词"""
    
    # 汇率（2026年参考）
    EXCHANGE_RATE = 21.0  # 1 人民币 = 21.0 日元
    
    return f"""
    你是一位专业的旅行财务顾问。请根据以下信息计算详细的{days}天旅行预算：

    ## 基本信息
    - 目的地：{destination}
    - 旅行天数：{days} 天
    - 总预算：{budget:,} 人民币
    - 旅行偏好：{preference}

    ## 当前汇率
    - 1 人民币 = {EXCHANGE_RATE} 日元（仅供参考）

    ## 费用预算分配建议（占总预算百分比）

    1. 💱 交通费用
       - 往返机票：约占总预算的 25-35%
       - 日本国内交通：约占总预算的 15-20%
       - 推荐使用 JR Pass（7 天通票）

    2. 🏨 住宿费用
       - 酒店：约占总预算的 25-35%
       - 推荐预订商务酒店或经济型酒店
       - 平均费用：1500-3000 人民币/晚

    3. 🍜 餐饮费用
       - 早餐 + 晚餐：约占总预算的 20-25%
       - 建议：便利店早餐 + 拉面晚餐
       - 平均费用：2000-3000 人民币/天

    4. 🎫 门票和娱乐
       - 约占总预算的 10-15%
       - 门票：寺庙、神社、环球影城、迪士尼（根据选择）
       - 平均费用：1000-2000 人民币/天

    5. 🛍 购物
       - 约占总预算的 5-10%
       - 建议：药妆店、电器店、百元店
       - 平均费用：根据购物计划而定

    6. 💳 其他费用
       - 电话卡：约 500 人民币/月
       - 旅游保险：约 300-1000 人民币/次
       - 应急备用金：建议预留 10,000 人民币

    ## 费用优化建议

    - 💡 当前汇率仅供参考，实际以银行兑换汇率为准
    - 💡 建议使用信用卡或当地 ATM 取现
    - 💡 日本大部分地方支持现金，但最好准备一些零钱
    - 💡 留出适量的购物和纪念品预算

    输出格式要求：
    - 使用表格形式展示费用明细
    - 包含总预算对比
    - 提供节约建议
    - 以 JSON 格式输出详细分析
    """
